services:
  app:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: collabio-app
    ports:
      - "${PORT:-3000}:3000"
    env_file:
      - .env
    environment:
      DATABASE_URL: "${DATABASE_URL:?DATABASE_URL environment variable is required}"
      NEXTAUTH_URL: "${NEXTAUTH_URL:-http://localhost:3000}"
      NEXTAUTH_SECRET: "${NEXTAUTH_SECRET:?NEXTAUTH_SECRET environment variable is required}"
      # Force container to always use port 3000 internally
      PORT: "3000"
    command: sh -c "npx prisma migrate deploy && node server.js"

